version: 3
projects:
- name: tf-atlantis-elk
  dir: ./terraform
  workflow: custom

workflows:
  custom:
    plan:
      steps:
      - env:
          name: GITHUB_USER
          value: "${{ GITHUB_USER }}"
      - env:
          name: GITHUB_TOKEN
          value: "${{ GITHUB_TOKEN }}"
      - env:
          name: GITHUB_SECRET
          value: "${{ GITHUB_SECRET }}"
      - env:
          name: KUBE_CONFIG_PATH
          value: "~/.kube/config"
      - init
      - plan

    apply:
      steps:
      - env:
          name: GITHUB_USER
          value: "${{ GITHUB_USER }}"
      - env:
          name: GITHUB_TOKEN
          value: "${{ GITHUB_TOKEN }}"
      - env:
          name: GITHUB_SECRET
          value: "${{ GITHUB_SECRET }}"
      - env:
          name: KUBE_CONFIG_PATH
          value: "~/.kube/config"
      - apply
