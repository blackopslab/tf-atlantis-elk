version: 3

automerge: false
delete_source_branch_on_merge: false
parallel_plan: true
parallel_apply: true

projects:
  - name: tf-atlantis-elk
    dir: ./terraform
    workflow: custom
    autoplan:
      enabled: true
      when_modified:
        - "*.tf"
        - "*.tfvars"
        - ".terraform.lock.hcl"

workflows:
  custom:
    plan:
      steps:
        - init
        - plan:
            extra_args:
              - -var-file
              - ./terraform/variables.tfvars

    apply:
      steps:
        - apply:
            extra_args:
              - -var-file
              - ./terraform/variables.tfvars
